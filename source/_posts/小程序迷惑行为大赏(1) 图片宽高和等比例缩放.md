---
title: 小程序迷惑行为大赏(1) 图片宽高和等比例缩放
date: 2021-01-11 12:13:00
tags:
---
（发牢骚）
在微信（和qq）小程序中，许多元素是有自带的默认样式的，这很正常，web也是这样。但是小程序中默认样式的选取则显得极端迷惑。
先看一下web标准里图片尺寸的css行为：
1、若width和height均未指定，则按照图片原尺寸显示图片
2、若width和height仅指定了一方，则另一方根据图片原始比例进行缩放
3、若width和height均已指定，则按指定的width和height进行显示

而在小程序中，如果我们按照web中的习惯进行使用，则会发现变成了这样
1、若width和height均已指定，那自然是猴面雀也能正常渲染
2、若width和height仅指定了一方，则发现未指定的一方变得血妈长
3、若width和height均未指定，则显示为固定大小

我说停停，怎么回事。然后一看开发者工具里的样式，哦，原来是小程序给image元素指定了默认宽高，搞小聪明偷袭开发者：
![没十年脑溢血想不出这个设计](/images/24121227-18b46d046e85bab3.png)

我一看那好办啊，如果我希望“不指定”某个样式，我把他改成默认样式就行了。在mdn上我们可以看到其实每个css的样式都有自己的默认值，当我们什么也没指定的时候就相当于指定了这个默认值。于是我们发现width和height属性的默认值是auto。
然后我们就用web试刀，哎，试了一下，果然指定为auto和不指定的缩放效果是一样的，很顺利啊，然后我们就进小程序。啪，我设置width为auto，他直接宽度变成0，来打我脸。
![当时流眼泪了](/images/24121227-7818e0abfb40ba20.jpg)
那也就，就没什么好说的了呗，微信小程序就是不支持web规范内css的“width或height为auto时自动缩放图片”

那可能有的水友就要问了：那如果我想要一个高度固定，宽度根据图片比例自适应的image元素怎么办呢？哎，微信也发现这个问题了，image元素的mode属性可以做这件事。
![你以为这就结束了？没这么容易！](/images/24121227-332b23be29cf8c85.png)
用了一下，非常有效，孩子很喜欢，给好……嗯？
发现一个问题：heightFix是有最低版本限制的（警觉）
后续调研发现：heightFix确实在低版本无效。另外，虽然qq小程序“兼容”微信小程序，但是两者对一些feature的支持版本不同，qq小程序也是不支持heightFix的。这啥意思呢，就是说脑溢血的小程序不知道是程序员还是产品经理觉得，只需要widthFix就够了嘛，要heightFix干嘛呢！后来大概是被人骂了才大发慈悲加上了罢。
另外还有个彩蛋：widthFix到底是什么？
![好活，好活啊](/images/24121227-746cf78cf12997c3.png)
我悟了，widthFix就是小程序给图片加了个和他高度/宽度对应比例的内联样式

那么问题来了，如果我要在低版本或者qq小程序得到heightFix的行为，我该咋办嘞？
那大概只能手动去做一下heightFix的事情了吧。image元素的bindload钩子内可以获取到图片的信息（只有宽高），这样我们就可以用js去处理这个问题了。话说回来，既然你的bindload里都有且只有宽高了，那我寻思其实小程序已经意识到自己设计很nt了吧？